!function(){"use strict";const P="https://hacker-news.firebaseio.com/v0/newstories.json",r="https://hacker-news.firebaseio.com/v0/topstories.json",o="https://hacker-news.firebaseio.com/v0/item/",a=document.querySelector(".top-btn"),d=document.querySelector(".new-btn"),l=document.querySelector(".reset-btn"),m=document.querySelector(".reset-comments-btn"),u=document.querySelector(".back-btn"),h=document.querySelector(".news-list__rating-btn"),_=document.querySelector(".news-list__date-btn"),v=document.querySelector(".news-list__body"),e=document.querySelector(".home-page"),w=document.querySelector(".news-list__error"),p=document.querySelector(".news-list__rating-svg"),y=document.querySelector(".news-list__date-svg"),t=document.querySelector(".news-page"),n=document.querySelector(".news-page__header"),L=document.querySelector(".comments__amount"),g=document.querySelector(".comments__wrapper"),N=document.querySelector(".comments__message"),f=document.querySelector(".comments__error"),b=document.querySelector(".preloader-news"),S=document.querySelector(".preloader-comments");let k=[],z=50,q,c,C=[],E=[],i;var F=isMobile.any;document.body.classList.add(F?"_mobile":"_pc");const $=e=>{e.classList.remove("hidden")},M=e=>{e.classList.add("hidden")},H=e=>{e.innerHTML=""},T=e=>e.classList.remove("up","down"),j=e=>{e.disabled=!0},x=e=>{e.disabled=!1},G=e=>{e.classList.add("active")},D=e=>{e.classList.remove("active")},I=()=>{$(t),M(e),M(l),M(a),M(d),$(u),$(m)},A=e=>fetch(e).then(e=>e.json()).then(e=>e).catch(e=>e),B=e=>{e=`
      <tr class="news-list__item row" style="cursor: pointer" data-id="${e.id}">
        <td class="news-list__item-title">
        ${e.title}
        </td>
        <td class="news-list__item-rating">${e.score}</td>
        <td class="news-list__item-author">${e.by}</td>
        <td class="news-list__item-date">${new Date(1e3*e.time).toLocaleString().slice(0,-3).replace(","," |")}
        </td>
      </tr>
    `;v.insertAdjacentHTML("beforeend",e)};function J(t){if(this.classList.contains("up")||this.classList.contains("down"))if(this.classList.contains("down")){{var s=t;H(v);let e;"date"===s&&(e=k.sort((e,t)=>e.time>t.time?1:-1)),(e="score"===s?k.sort((e,t)=>e.score>t.score?1:-1):e).forEach(e=>B(e))}this.classList.remove("down"),this.classList.add("up")}else this.classList.contains("up")&&(K(t),this.classList.remove("up"),this.classList.add("down"));else K(t),this.classList.add("down")}const s=async e=>{try{H(v),H(w),j(l),j(a),j(d),j(h),j(_),$(b),D(a),D(d),T(h),T(_),$(p),$(y);var t=e;try{q=t;const n=await A(t);if(n.error)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. üôÑ");const c=n.slice(0,z);var s=c.map(e=>A(""+o+e+".json"));if(!(k=await Promise.all(s)))throw new Error("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. üôÑ");for(const i of k)B(i)}catch(e){w.innerHTML=e.message}await 0,M(b),x(l),x(h),x(_),q===r&&(x(d),D(d),G(a)),q===P&&(x(a),D(a),G(d))}catch(e){w.innerHTML=e.message}},K=e=>{H(v);let t;"date"===e&&(t=k.sort((e,t)=>e.time>t.time?-1:1)),(t="score"===e?k.sort((e,t)=>e.score>t.score?-1:1):t).forEach(e=>B(e))},O=async e=>{try{var t=e.map(e=>A(""+o+e+".json"));if(t)return await Promise.all(t);throw new Error("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. üôÑ")}catch(e){f.innerHTML=e.message}},Q=(t,s,n)=>{s=s||n.id;const c=[];return t.forEach(e=>{e.parent===s&&(c.push(e),e.children=Q(t,e.id,n),e.children.length||delete e.children)}),c},R=(e,s,t="")=>{let n=document.createElement("ul");return t&&n.classList.add(t),e&&e.forEach(e=>{let t=document.createElement("li");e.parent===s.id?t.classList.add("comments__item","comment-root"):t.classList.add("comments__item","comment-nested","hidden"),t.insertAdjacentHTML("beforeend",(e=>{let t="";var s;return e.kids&&(11<=(s=String(e.kids.length))&&s<=15?t="–æ–≤":2<=s[s.length-1]&&s[s.length-1]<5?t="–∞":(5<=s[s.length-1]&&s[s.length-1]<=10||0===s[s.length-1])&&(t="–æ–≤")),`
      <div class="${e.kids?"comment has-child":"comment"}">       
        <div class="comments__item-header">
          <div class="comments__author">${e.by}</div>
          <div class="comments__time">${new Date(1e3*e.time).toLocaleString().slice(0,-3).replace(","," |")}</div>
        </div>
        <div class="comments__item-body">
        ${e.text}
        </div>
        ${e.kids?'<div class="comments__answers up"><span>':""}
        ${e.kids?e.kids.length+" –æ—Ç–≤–µ—Ç"+t:""}
        </span></div>
      </div> 
    `})(e)),n.append(t);e=R(e.children,s,"child-comments");e&&t.append(e)}),n},U=(e,t,s)=>{e.append(R(t,s))},V=async(e,t)=>{try{const r=await O(e);if(!r)throw new Error("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. üôÑ");var s=r.filter(e=>e.text),n=(E.push(s),E.flat());const o=[];for(const a of s)a.kids&&o.push(a.kids);var c,i=o.flat();0===i.length&&(c=Q(n,void 0,t),U(g,c,t),M(S),x(u),x(m),L.innerHTML=`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${t.descendants}):`,console.log(t),console.log(t.descendants),E=[],C=[]),0!==o.length&&await V(i,t)}catch(e){f.innerHTML=e.message}},W=async e=>{try{if(!(c=await A(""+o+e+".json")))throw new Error("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. üôÑ");t=c,s=t.text?`<div class="news__text">${t.text}</div>`:"",t=`
      <div class="news__title">${t.title}</div>
      <div class="news__info">
        <div class="news__author">author: <span>${t.by}</span></div>
  
        <div class="news__date">
            date: <span>${new Date(1e3*t.time).toLocaleString().slice(0,-3).replace(","," |")}</span>
        </div>
      </div>
      <div class="news__link">
        <a href="${t.url}" target="_blank">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É</a>
      </div>
      ${s}
      `,n.insertAdjacentHTML("afterbegin",t),n.style.borderBottom="1px solid #000",c.text&&(document.querySelector(".news__text").style.display="block"),i=c.kids,X()}catch(e){M(S),f.innerHTML=e.message}var t,s},X=()=>{H(f),H(g),H(L),$(S),i?(j(m),V(i,c)):(M(S),$(N),x(u),x(m))};a.addEventListener("click",()=>s(r)),d.addEventListener("click",()=>s(P)),l.addEventListener("click",()=>{j(l),H(v),$(e),M(t),$(b),s(q)}),u.addEventListener("click",()=>{$(e),M(t),$(l),M(u),M(m),$(a),$(d)}),m.addEventListener("click",X),v.addEventListener("click",e=>{e.preventDefault();var e=e.target.closest(".news-list__item");e&&(e.dataset.id==c?.id?I():(e=e.dataset.id,I(),$(S),M(N),H(n),H(L),H(g),n.style.borderBottom="none",j(m),j(u),W(e)))}),g.addEventListener("click",e=>{e.preventDefault();const t=e.target.closest(".comments__item");if("A"===e.target.tagName&&window.open(e.target.innerHTML),t){const s=[...t.querySelector(".child-comments").children];s.forEach(e=>e.classList.toggle("hidden")),t.querySelector(".comments__answers")?.classList.toggle("up"),t.querySelector(".has-child").classList.toggle("active")}}),h.addEventListener("click",function(e){e.preventDefault(),M(p),T(_),$(y);const t=J.bind(this);t("score")}),_.addEventListener("click",function(){M(y),T(h),$(p);const e=J.bind(this);e("date")}),s(r)}();